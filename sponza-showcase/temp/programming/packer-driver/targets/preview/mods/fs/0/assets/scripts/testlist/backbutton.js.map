{"version":3,"sources":["file:///D:/Deferred_RenderPipeline/sponza-showcase/assets/scripts/testlist/backbutton.ts"],"names":["_decorator","Component","director","game","ScrollViewComponent","Vec3","LayoutComponent","Canvas","Layers","sceneArray","ccclass","property","BackButton","saveOffset","_scrollNode","_offset","_scrollCom","getScrollOffset","y","saveIndex","index","_sceneIndex","refreshButton","_prevNode","active","_nextNode","__preload","sceneInfo","_sceneInfos","firstIndex","lastIndex","sceneString","i","length","url","lastIndexOf","substring","push","start","camera","node","getComponent","cameraComponent","visibility","Enum","UI_2D","addPersistRootNode","getParent","getChildByPath","_blockInput","getChildByName","backToList","loadScene","_content","updateLayout","scrollToOffset","offset","nextscene","updateSceneIndex","getSceneName","prescene","next","value"],"mappings":"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","sourcesContent":["import { _decorator, ButtonComponent, Component, director, game, Node, ScrollViewComponent, Vec3, LayoutComponent, Canvas, Layers } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\nimport { sceneArray } from './scenelist';\r\n\r\n@ccclass('BackButton')\r\nexport class BackButton extends Component {\r\n\r\n    public static get offset () {\r\n        return BackButton._offset;\r\n    }\r\n\r\n    public static set offset ( value ) {\r\n        BackButton._offset = value;\r\n    }\r\n    public static _scrollNode: Node | null  = null;\r\n\r\n    public static saveOffset () {\r\n        if ( BackButton._scrollNode ) {\r\n            BackButton._offset = new Vec3(0, BackButton._scrollCom.getScrollOffset().y, 0);\r\n        }\r\n    }\r\n\r\n    public static saveIndex ( index: number) {\r\n        BackButton._sceneIndex = index;\r\n        BackButton.refreshButton();\r\n    }\r\n\r\n    public static refreshButton () {\r\n        if (BackButton._sceneIndex === -1) {\r\n            BackButton._prevNode.active = false;\r\n            BackButton._nextNode.active = false;\r\n        } else {\r\n            BackButton._prevNode.active = true;\r\n            BackButton._nextNode.active = true;\r\n        }\r\n    }\r\n    private static _offset = new Vec3();\r\n    private static _scrollCom: ScrollViewComponent | null = null;\r\n\r\n    private static _sceneIndex: number = -1;\r\n    private static _blockInput : Node;\r\n    private static _prevNode: Node;\r\n    private static _nextNode: Node;\r\n\r\n    public __preload () {\r\n        const sceneInfo = game._sceneInfos;\r\n        let firstIndex = 0;\r\n        let lastIndex = 0;\r\n        let sceneString: string = '';\r\n        for (let i = 0; i < sceneInfo.length; i++){\r\n            sceneString = sceneInfo[i].url;\r\n            firstIndex = sceneString.lastIndexOf('/') + 1;\r\n            lastIndex = sceneString.lastIndexOf('.scene');\r\n            sceneString = sceneString.substring(firstIndex, lastIndex);\r\n            if (sceneString === 'testlist') {\r\n                continue;\r\n            }\r\n            sceneArray.push(sceneString);\r\n        }\r\n    }\r\n\r\n    public start () {\r\n        let camera = this.node.getComponent(Canvas)!.cameraComponent!;\r\n        if (camera.visibility & Layers.Enum.UI_2D) camera.visibility &= ~Layers.Enum.UI_2D;\r\n        game.addPersistRootNode(this.node);\r\n        BackButton._scrollNode = this.node.getParent().getChildByPath('Canvas/ScrollView') as Node;\r\n        if (BackButton._scrollNode) {\r\n            BackButton._scrollCom = BackButton._scrollNode.getComponent(ScrollViewComponent);\r\n        }\r\n        BackButton._blockInput = this.node.getChildByName('BlockInput') as Node;\r\n        BackButton._blockInput.active = false;\r\n        BackButton._prevNode = this.node.getChildByName('PrevButton') as Node;\r\n        BackButton._nextNode = this.node.getChildByName('NextButton') as Node;\r\n        if (BackButton._prevNode && BackButton._nextNode) {\r\n            BackButton.refreshButton();\r\n        }\r\n    }\r\n\r\n    public backToList () {\r\n        BackButton._blockInput.active = true;\r\n        director.loadScene('testlist', () => {\r\n            BackButton._sceneIndex = -1;\r\n            BackButton.refreshButton();\r\n            BackButton._scrollNode = this.node.getParent().getChildByPath('Canvas/ScrollView') as Node;\r\n            if (BackButton._scrollNode) {\r\n                BackButton._scrollCom = BackButton._scrollNode.getComponent(ScrollViewComponent);\r\n                // @ts-ignore\r\n                BackButton._scrollCom._content.getComponent(LayoutComponent).updateLayout();\r\n                BackButton._scrollCom.scrollToOffset(BackButton.offset, 0.1, true);\r\n            }\r\n            BackButton._blockInput.active = false;\r\n        });\r\n    }\r\n\r\n    public nextscene () {\r\n        BackButton._blockInput.active = true;\r\n        this.updateSceneIndex(true);\r\n        director.loadScene(this.getSceneName(), () => {\r\n            BackButton._blockInput.active = false;\r\n        });\r\n    }\r\n\r\n    public prescene () {\r\n        BackButton._blockInput.active = true;\r\n        this.updateSceneIndex(false);\r\n        director.loadScene(this.getSceneName(), () => {\r\n            BackButton._blockInput.active = false;\r\n        });\r\n    }\r\n\r\n    public updateSceneIndex (next: Boolean) {\r\n        if (next) {\r\n            (BackButton._sceneIndex + 1) >= sceneArray.length ? BackButton._sceneIndex = 0 : BackButton._sceneIndex += 1;\r\n        }else {\r\n            (BackButton._sceneIndex - 1) < 0 ? BackButton._sceneIndex = sceneArray.length - 1 : BackButton._sceneIndex -= 1;\r\n        }\r\n    }\r\n\r\n    public getSceneName () {\r\n        return sceneArray[BackButton._sceneIndex];\r\n    }\r\n}\r\n"]}