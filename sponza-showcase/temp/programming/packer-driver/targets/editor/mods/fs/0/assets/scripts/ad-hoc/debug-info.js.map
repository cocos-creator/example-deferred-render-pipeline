{"version":3,"sources":["file:///D:/Deferred_RenderPipeline/sponza-showcase/assets/scripts/ad-hoc/debug-info.ts"],"names":["_decorator","Component","ModelComponent","director","GFXAPI","ccclass","property","gl","DebugInfo","printActiveUniforms","root","device","gfxAPI","WEBGL","WEBGL2","targets","forEach","comp","console","log","node","name","psoCI","_model","_subModels","_psoCreateInfos","shader","gpuShader","glBlocks","reduce","acc","cur","concat","glActiveUniforms","u","data","getUniform","glProgram","getUniformLocation","Array","from","toFixed","scenes","windows","views","printJointsTexture","info","dataPoolManager","jointTexturePool","_pool","_chunks","texture","_gpuTexture","glTexture","pixels","Float32Array","width","height","fb","createFramebuffer","bindFramebuffer","FRAMEBUFFER","framebufferTexture2D","COLOR_ATTACHMENT0","TEXTURE_2D","readPixels","RGBA","FLOAT","str","i","length"],"mappings":"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","sourcesContent":["import { _decorator, Component, ModelComponent, director, GFXAPI } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\n\r\nlet gl: WebGLRenderingContext | null = null;\r\n\r\n@ccclass('DebugInfo')\r\nexport class DebugInfo extends Component {\r\n\r\n    @property([ModelComponent])\r\n    public targets: ModelComponent[] = [];\r\n\r\n    public printActiveUniforms () {\r\n        if (director.root.device.gfxAPI === GFXAPI.WEBGL || director.root.device.gfxAPI === GFXAPI.WEBGL2) {\r\n            this.targets.forEach((comp) => {\r\n                console.log(comp.node.name, '---------------------------------------');\r\n                // @ts-ignore\r\n                const psoCI = comp._model._subModels[0]._psoCreateInfos[0]; gl = director.root.device.gl; const shader = psoCI.shader.gpuShader;\r\n                shader.glBlocks.reduce((acc: any[], cur: any) => acc.concat(cur.glActiveUniforms), []).forEach((u: any) => {\r\n                    const data = gl.getUniform(shader.glProgram, gl.getUniformLocation(shader.glProgram, u.name)) as Float32Array;\r\n                    console.log(u.name, Array.from(data).reduce((acc, cur) => `${acc} ${cur.toFixed(2)}`, ''));\r\n                });\r\n            });\r\n        }\r\n        console.log('scene', director.root.scenes);\r\n        console.log('window', director.root.windows);\r\n        console.log('view', director.root.views);\r\n    }\r\n\r\n    public printJointsTexture () {\r\n        // @ts-ignore\r\n        const info = director.root.dataPoolManager.jointTexturePool._pool._chunks[0].texture;\r\n        const texture = info._gpuTexture.glTexture;\r\n        const pixels = new Float32Array(info.width * info.height * 4);\r\n\r\n        const fb = gl.createFramebuffer();\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, fb);\r\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\r\n        gl.readPixels(0, 0, info.width, info.height, gl.RGBA, gl.FLOAT, pixels);\r\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\r\n\r\n        let str = '';\r\n        for (let i = 0; i < pixels.length; i++) {\r\n            str += pixels[i] + ' ';\r\n            if ((i + 1) % 12 === 0) { str += '\\n'; }\r\n        }\r\n        console.log(str);\r\n    }\r\n}\r\n"]}