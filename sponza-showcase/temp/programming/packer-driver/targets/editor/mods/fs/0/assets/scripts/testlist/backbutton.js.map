{"version":3,"sources":["file:///D:/Deferred_RenderPipeline/sponza-showcase/assets/scripts/testlist/backbutton.ts"],"names":["_decorator","Component","director","game","ScrollViewComponent","Vec3","LayoutComponent","Canvas","Layers","sceneArray","ccclass","property","BackButton","offset","_offset","value","saveOffset","_scrollNode","_scrollCom","getScrollOffset","y","saveIndex","index","_sceneIndex","refreshButton","_prevNode","active","_nextNode","__preload","sceneInfo","_sceneInfos","firstIndex","lastIndex","sceneString","i","length","url","lastIndexOf","substring","push","start","camera","node","getComponent","cameraComponent","visibility","Enum","UI_2D","addPersistRootNode","getParent","getChildByPath","_blockInput","getChildByName","backToList","loadScene","_content","updateLayout","scrollToOffset","nextscene","updateSceneIndex","getSceneName","prescene","next"],"mappings":"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","sourcesContent":["import { _decorator, ButtonComponent, Component, director, game, Node, ScrollViewComponent, Vec3, LayoutComponent, Canvas, Layers } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\nimport { sceneArray } from './scenelist';\r\n\r\n@ccclass('BackButton')\r\nexport class BackButton extends Component {\r\n\r\n    public static get offset () {\r\n        return BackButton._offset;\r\n    }\r\n\r\n    public static set offset ( value ) {\r\n        BackButton._offset = value;\r\n    }\r\n    public static _scrollNode: Node | null  = null;\r\n\r\n    public static saveOffset () {\r\n        if ( BackButton._scrollNode ) {\r\n            BackButton._offset = new Vec3(0, BackButton._scrollCom.getScrollOffset().y, 0);\r\n        }\r\n    }\r\n\r\n    public static saveIndex ( index: number) {\r\n        BackButton._sceneIndex = index;\r\n        BackButton.refreshButton();\r\n    }\r\n\r\n    public static refreshButton () {\r\n        if (BackButton._sceneIndex === -1) {\r\n            BackButton._prevNode.active = false;\r\n            BackButton._nextNode.active = false;\r\n        } else {\r\n            BackButton._prevNode.active = true;\r\n            BackButton._nextNode.active = true;\r\n        }\r\n    }\r\n    private static _offset = new Vec3();\r\n    private static _scrollCom: ScrollViewComponent | null = null;\r\n\r\n    private static _sceneIndex: number = -1;\r\n    private static _blockInput : Node;\r\n    private static _prevNode: Node;\r\n    private static _nextNode: Node;\r\n\r\n    public __preload () {\r\n        const sceneInfo = game._sceneInfos;\r\n        let firstIndex = 0;\r\n        let lastIndex = 0;\r\n        let sceneString: string = '';\r\n        for (let i = 0; i < sceneInfo.length; i++){\r\n            sceneString = sceneInfo[i].url;\r\n            firstIndex = sceneString.lastIndexOf('/') + 1;\r\n            lastIndex = sceneString.lastIndexOf('.scene');\r\n            sceneString = sceneString.substring(firstIndex, lastIndex);\r\n            if (sceneString === 'testlist') {\r\n                continue;\r\n            }\r\n            sceneArray.push(sceneString);\r\n        }\r\n    }\r\n\r\n    public start () {\r\n        let camera = this.node.getComponent(Canvas)!.cameraComponent!;\r\n        if (camera.visibility & Layers.Enum.UI_2D) camera.visibility &= ~Layers.Enum.UI_2D;\r\n        game.addPersistRootNode(this.node);\r\n        BackButton._scrollNode = this.node.getParent().getChildByPath('Canvas/ScrollView') as Node;\r\n        if (BackButton._scrollNode) {\r\n            BackButton._scrollCom = BackButton._scrollNode.getComponent(ScrollViewComponent);\r\n        }\r\n        BackButton._blockInput = this.node.getChildByName('BlockInput') as Node;\r\n        BackButton._blockInput.active = false;\r\n        BackButton._prevNode = this.node.getChildByName('PrevButton') as Node;\r\n        BackButton._nextNode = this.node.getChildByName('NextButton') as Node;\r\n        if (BackButton._prevNode && BackButton._nextNode) {\r\n            BackButton.refreshButton();\r\n        }\r\n    }\r\n\r\n    public backToList () {\r\n        BackButton._blockInput.active = true;\r\n        director.loadScene('testlist', () => {\r\n            BackButton._sceneIndex = -1;\r\n            BackButton.refreshButton();\r\n            BackButton._scrollNode = this.node.getParent().getChildByPath('Canvas/ScrollView') as Node;\r\n            if (BackButton._scrollNode) {\r\n                BackButton._scrollCom = BackButton._scrollNode.getComponent(ScrollViewComponent);\r\n                // @ts-ignore\r\n                BackButton._scrollCom._content.getComponent(LayoutComponent).updateLayout();\r\n                BackButton._scrollCom.scrollToOffset(BackButton.offset, 0.1, true);\r\n            }\r\n            BackButton._blockInput.active = false;\r\n        });\r\n    }\r\n\r\n    public nextscene () {\r\n        BackButton._blockInput.active = true;\r\n        this.updateSceneIndex(true);\r\n        director.loadScene(this.getSceneName(), () => {\r\n            BackButton._blockInput.active = false;\r\n        });\r\n    }\r\n\r\n    public prescene () {\r\n        BackButton._blockInput.active = true;\r\n        this.updateSceneIndex(false);\r\n        director.loadScene(this.getSceneName(), () => {\r\n            BackButton._blockInput.active = false;\r\n        });\r\n    }\r\n\r\n    public updateSceneIndex (next: Boolean) {\r\n        if (next) {\r\n            (BackButton._sceneIndex + 1) >= sceneArray.length ? BackButton._sceneIndex = 0 : BackButton._sceneIndex += 1;\r\n        }else {\r\n            (BackButton._sceneIndex - 1) < 0 ? BackButton._sceneIndex = sceneArray.length - 1 : BackButton._sceneIndex -= 1;\r\n        }\r\n    }\r\n\r\n    public getSceneName () {\r\n        return sceneArray[BackButton._sceneIndex];\r\n    }\r\n}\r\n"]}